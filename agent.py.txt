from intent import detect_intent
from rag import retrieve_answer
from tools import mock_lead_capture

state = {
    "name": None,
    "email": None,
    "platform": None
}

def agent_response(user_input):
    intent = detect_intent(user_input)

    if intent == "greeting":
        return "Hi! I can help you with AutoStream pricing and plans."

    if intent == "pricing":
        pricing = retrieve_answer("pricing")
        return str(pricing)

    if intent == "high_intent":
        if not state["name"]:
            return "Great! May I have your name?"
        if not state["email"]:
            return "Thanks. Can I get your email address?"
        if not state["platform"]:
            return "Which platform do you create content on? (YouTube, Instagram, etc.)"

    if "@" in user_input and not state["email"]:
        state["email"] = user_input
        return "Got it. Which platform do you create content on?"

    if not state["name"]:
        state["name"] = user_input
        return "Thanks! Please share your email."

    if not state["platform"]:
        state["platform"] = user_input
        mock_lead_capture(
            state["name"],
            state["email"],
            state["platform"]
        )
        return "You're all set! Our team will reach out soon."

    return "How else can I help?"
